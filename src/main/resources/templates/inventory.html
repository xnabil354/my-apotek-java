<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">
  <body>
    <div layout:fragment="content">
      <div class="card">
        <h3
          style="
            margin-bottom: 0.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
          "
        >
          <i class="fa-solid fa-boxes-stacked"></i> Inventory Obat
        </h3>
        <p
          style="
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-size: 1.05rem;
          "
        >
          Kelola stok obat dengan sistem faktur dan multi-harga.
        </p>

        <div th:if="${success}" class="alert alert-success">
          <i class="fa-solid fa-circle-check"></i>
          <span th:text="${success}"></span>
        </div>
        <div th:if="${error}" class="alert alert-danger">
          <i class="fa-solid fa-circle-xmark"></i>
          <span th:text="${error}"></span>
        </div>
        <form
          th:action="@{/inventory/add}"
          th:object="${newObat}"
          method="post"
        >
          <div class="form-grid">
            <div class="form-group">
              <label><i class="fa-solid fa-tag"></i> Nama Obat</label>
              <input
                type="text"
                th:field="*{namaObat}"
                placeholder="Nama obat..."
                required
              />
            </div>
            <div class="form-group">
              <label><i class="fa-solid fa-file-invoice"></i> No Faktur</label>
              <input
                type="text"
                th:field="*{noFaktur}"
                placeholder="No faktur pembelian..."
                required
              />
            </div>
            <div class="form-group">
              <label><i class="fa-solid fa-hashtag"></i> Nomor Batch</label>
              <input
                type="text"
                th:field="*{nomorBatch}"
                placeholder="Nomor batch..."
              />
            </div>
            <div class="form-group">
              <label><i class="fa-solid fa-building"></i> Nama PBF</label>
              <input
                type="text"
                th:field="*{namaPBF}"
                placeholder="Pedagang Besar Farmasi..."
              />
            </div>
            <div class="form-group">
              <label><i class="fa-solid fa-calendar"></i> Tgl Produksi</label>
              <input type="date" th:field="*{tglProduksi}" />
            </div>
            <div class="form-group">
              <label
                ><i class="fa-solid fa-calendar-xmark"></i> Tgl Expired</label
              >
              <input type="date" th:field="*{tglExpired}" />
            </div>
            <div class="form-group">
              <label><i class="fa-solid fa-truck"></i> Supplier</label>
              <input
                type="text"
                th:field="*{supplier}"
                placeholder="Supplier..."
              />
            </div>
            <div class="form-group">
              <label><i class="fa-solid fa-ruler"></i> Satuan</label>
              <input
                type="text"
                th:field="*{satuan}"
                placeholder="Tab/Kapsul/Strip/Botol..."
              />
            </div>
            <div class="form-group">
              <label
                ><i class="fa-solid fa-layer-group"></i> Golongan Obat</label
              >
              <select th:field="*{golongan}">
                <option value="">-- Pilih Golongan --</option>
                <option value="Obat Bebas">Obat Bebas</option>
                <option value="Obat Bebas Terbatas (Daftar W)">
                  Obat Bebas Terbatas (Daftar W)
                </option>
                <option value="Obat Keras (Daftar G)">
                  Obat Keras (Daftar G)
                </option>
                <option value="Obat Narkotika">Obat Narkotika</option>
                <option value="Obat Psikotropika">Obat Psikotropika</option>
                <option value="Obat Herbal">Obat Herbal</option>
                <option value="Fitofarmaka">Fitofarmaka</option>
                <option value="Jamu">Jamu</option>
                <option value="Obat KB">Obat KB</option>
                <option value="Obat Anti Serangga">Obat Anti Serangga</option>
                <option value="Makanan">Makanan</option>
                <option value="Makanan Khusus Bayi/Balita">
                  Makanan Khusus Bayi/Balita
                </option>
                <option value="Food Suplemen">Food Suplemen</option>
                <option value="Kelompok Minuman">Kelompok Minuman</option>
                <option value="OOT">OOT</option>
                <option value="Cosmetic/Alat Kecantikan">
                  Cosmetic/Alat Kecantikan
                </option>
                <option value="Konsinyasi">Konsinyasi</option>
                <option value="Alat Kesehatan">Alat Kesehatan</option>
                <option value="Diagnostic Test/Laborat">
                  Diagnostic Test/Laborat
                </option>
                <option value="Obat-Obatan Tertentu">
                  Obat-Obatan Tertentu
                </option>
                <option value="Antiseptik">Antiseptik</option>
                <option value="Alat KB">Alat KB</option>
                <option value="Listrik">Listrik</option>
                <option value="Perlengkapan Bayi">Perlengkapan Bayi</option>
                <option value="Optik">Optik</option>
                <option value="Prekursor">Prekursor</option>
                <option value="Susu">Susu</option>
                <option value="Pembalut">Pembalut</option>
                <option value="Tissu">Tissu</option>
                <option value="Pewangi">Pewangi</option>
                <option value="Suplemen">Suplemen</option>
                <option value="Lain-Lain">Lain-Lain</option>
              </select>
            </div>
            <div class="form-group">
              <label><i class="fa-solid fa-cubes"></i> Quantity</label>
              <input
                type="number"
                th:field="*{quantity}"
                placeholder="Jumlah..."
                required
                min="1"
              />
            </div>
            <div class="form-group">
              <label><i class="fa-solid fa-percent"></i> Diskon (%)</label>
              <input
                type="number"
                th:field="*{diskonPersen}"
                placeholder="0"
                step="0.01"
                min="0"
                max="100"
              />
            </div>
            <div class="form-group">
              <label
                ><i class="fa-solid fa-credit-card"></i> Metode
                Pembayaran</label
              >
              <select
                th:field="*{metodePembayaran}"
                id="metodePembayaran"
                onchange="toggleTempo()"
              >
                <option value="">-- Pilih --</option>
                <option value="CASH">Cash</option>
                <option value="TEMPO">Tempo / Kredit</option>
                <option value="KONSINYASI">Konsinyasi</option>
              </select>
            </div>
            <div class="form-group" id="tempoGroup" style="display: none">
              <label
                ><i class="fa-solid fa-calendar-days"></i> Jatuh Tempo
                (Hari)</label
              >
              <input
                type="number"
                th:field="*{jatuhTempo}"
                placeholder="Jumlah hari..."
                min="1"
              />
            </div>
            <div class="form-group">
              <label
                ><i class="fa-solid fa-file-invoice"></i> Jenis Faktur</label
              >
              <select th:field="*{jenisFaktur}">
                <option value="">-- Pilih --</option>
                <option value="KONSINYASI">Konsinyasi</option>
                <option value="NON_KONSINYASI">Non-Konsinyasi</option>
              </select>
            </div>
          </div>
          <div
            class="card"
            style="
              background: #f0fdf4;
              border: 2px solid #bbf7d0;
              margin-top: 1rem;
            "
          >
            <h4 style="color: #166534; margin-bottom: 1rem; font-size: 0.95rem">
              <i class="fa-solid fa-money-bills"></i> PRICING (Multi-Harga)
            </h4>
            <div class="form-grid">
              <div class="form-group">
                <label>Harga Beli (Rp)</label>
                <input
                  type="number"
                  th:field="*{hargaBeli}"
                  id="hargaBeli"
                  placeholder="0"
                  step="0.01"
                  oninput="calcPPN()"
                />
              </div>
              <div class="form-group">
                <label>Harga Beli + PPN 11% (Rp)</label>
                <input
                  type="number"
                  th:field="*{hargaBeliPpn}"
                  id="hargaBeliPpn"
                  placeholder="Auto-calculated"
                  readonly
                  style="background: #e2e8f0; font-weight: 700"
                />
              </div>
              <div class="form-group">
                <label>Harga Jual Apotek (Rp)</label>
                <input
                  type="number"
                  th:field="*{hargaJualApotek}"
                  placeholder="0"
                  step="0.01"
                />
              </div>
              <div class="form-group">
                <label>Harga Plot (Rp)</label>
                <input
                  type="number"
                  th:field="*{hargaPlot}"
                  placeholder="0"
                  step="0.01"
                />
              </div>
            </div>
          </div>
          <div class="form-group" style="margin-top: 1rem">
            <label
              ><i class="fa-solid fa-book-medical"></i> Indikasi / Kegunaan
              (MIMS)</label
            >
            <textarea
              th:field="*{indikasi}"
              rows="2"
              placeholder="Deskripsi indikasi & kegunaan obat..."
            ></textarea>
          </div>

          <button
            type="submit"
            class="btn btn-primary"
            style="margin-top: 1rem; width: 100%"
          >
            <i class="fa-solid fa-plus"></i> Tambah Obat ke Inventory
          </button>
        </form>
      </div>
      <div class="card">
        <h3 style="margin-bottom: 1.5rem">
          <i class="fa-solid fa-list"></i> Daftar Obat
        </h3>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>No Faktur</th>
                <th>Nama Obat</th>
                <th>Batch</th>
                <th>PBF</th>
                <th>Satuan</th>
                <th>Golongan</th>
                <th>Qty</th>
                <th>H. Beli</th>
                <th>H. Beli+PPN</th>
                <th>H. Jual</th>
                <th>H. Plot</th>
                <th>Diskon</th>
                <th>Pembayaran</th>
                <th>Faktur</th>
                <th>Expired</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="obat : ${obatList}">
                <td
                  style="font-family: monospace; font-weight: 600"
                  th:text="${obat.noFaktur}"
                >
                  -
                </td>
                <td th:text="${obat.namaObat}">Obat</td>
                <td th:text="${obat.nomorBatch}">-</td>
                <td th:text="${obat.namaPBF}">-</td>
                <td th:text="${obat.satuan}">-</td>
                <td th:text="${obat.golongan}">-</td>
                <td>
                  <span
                    th:text="${obat.quantity}"
                    th:style="${obat.quantity != null && obat.quantity < 10 ? 'color: var(--accent); font-weight: 800' : 'font-weight: 600'}"
                    >0</span
                  >
                </td>
                <td
                  th:text="${obat.hargaBeli != null ? 'Rp ' + #numbers.formatDecimal(obat.hargaBeli, 0, 'COMMA', 0, 'POINT') : '-'}"
                >
                  -
                </td>
                <td
                  th:text="${obat.hargaBeliPpn != null ? 'Rp ' + #numbers.formatDecimal(obat.hargaBeliPpn, 0, 'COMMA', 0, 'POINT') : '-'}"
                >
                  -
                </td>
                <td
                  th:text="${obat.hargaJualApotek != null ? 'Rp ' + #numbers.formatDecimal(obat.hargaJualApotek, 0, 'COMMA', 0, 'POINT') : '-'}"
                >
                  -
                </td>
                <td
                  th:text="${obat.hargaPlot != null ? 'Rp ' + #numbers.formatDecimal(obat.hargaPlot, 0, 'COMMA', 0, 'POINT') : '-'}"
                >
                  -
                </td>
                <td
                  th:text="${obat.diskonPersen != null ? obat.diskonPersen + '%' : '-'}"
                >
                  -
                </td>
                <td
                  th:text="${obat.metodePembayaran != null ? obat.metodePembayaran : '-'}"
                >
                  -
                </td>
                <td
                  th:text="${obat.jenisFaktur != null ? obat.jenisFaktur : '-'}"
                >
                  -
                </td>
                <td th:text="${obat.tglExpired}">-</td>
                <td>
                  <span
                    th:if="${obat.quantity != null && obat.quantity < 10}"
                    style="color: var(--accent); font-weight: 700"
                  >
                    <i class="fa-solid fa-triangle-exclamation"></i> Low
                  </span>
                  <span
                    th:if="${obat.quantity == null || obat.quantity >= 10}"
                    style="color: var(--success); font-weight: 600"
                  >
                    <i class="fa-solid fa-check-circle"></i> OK
                  </span>
                </td>
              </tr>
              <tr th:if="${obatList.isEmpty()}">
                <td
                  colspan="16"
                  style="
                    text-align: center;
                    color: var(--text-muted);
                    padding: 2rem;
                  "
                >
                  Belum ada obat di inventory
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <script>
        function calcPPN() {
          var hb = parseFloat(document.getElementById("hargaBeli").value) || 0;
          document.getElementById("hargaBeliPpn").value = (hb * 1.11).toFixed(
            2,
          );
        }
        function toggleTempo() {
          var m = document.getElementById("metodePembayaran").value;
          document.getElementById("tempoGroup").style.display =
            m === "TEMPO" ? "block" : "none";
        }
        toggleTempo();
      </script>
    </div>
  </body>
</html>
