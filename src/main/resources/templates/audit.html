<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">
  <body>
    <div layout:fragment="content">
      <div class="card">
        <h3
          style="
            margin-bottom: 0.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
          "
        >
          <i class="fa-solid fa-scale-balanced"></i> Stock Opname (Audit Flow)
        </h3>
        <p
          style="
            color: var(--text-muted);
            margin-bottom: 2.5rem;
            font-size: 1.1rem;
          "
        >
          Verified inventory auditing process. Follow the secure sequence: Scan
          -> Verify System -> Manual Count -> Final Validation.
        </p>

        <div th:if="${error}" class="alert alert-danger">
          <i class="fa-solid fa-circle-xmark"></i>
          <span th:text="${error}"></span>
        </div>

        <div
          th:if="${auditResult}"
          class="alert"
          th:classappend="${auditResult.contains('✅') ? 'alert-success' : 'alert-danger'}"
        >
          <i
            th:class="${auditResult.contains('✅') ? 'fa-solid fa-circle-check' : 'fa-solid fa-triangle-exclamation'}"
          ></i>
          <b th:text="${auditResult}"></b>
        </div>

        <form th:action="@{/audit/check}" method="post">
          <!-- STEP 1: SCAN -->
          <div
            class="card"
            style="
              background: rgba(37, 99, 235, 0.05);
              border: 2px dashed var(--primary);
              padding: 2rem;
            "
          >
            <label
              style="
                font-weight: 800;
                color: var(--primary);
                display: flex;
                align-items: center;
                gap: 8px;
              "
            >
              <i class="fa-solid fa-camera-retro"></i> 1. SCAN BARCODE / SKU
            </label>
            <div style="display: flex; gap: 1rem; margin-top: 1rem">
              <input
                type="text"
                name="barcode"
                th:value="${item != null ? item.barcode : ''}"
                placeholder="Ready for scan..."
                required
                style="
                  flex: 1;
                  font-size: 1.2rem;
                  height: 60px;
                  border-radius: 30px;
                  padding: 0 2rem;
                "
              />
              <button
                type="submit"
                class="btn btn-primary"
                style="
                  height: 60px;
                  border-radius: 30px;
                  padding: 0 2.5rem;
                  font-size: 1rem;
                "
              >
                <i class="fa-solid fa-magnifying-glass"></i> VERIFY ITEM
              </button>
            </div>
          </div>

          <div
            th:if="${item}"
            style="margin-top: 3rem; animation: fadeIn 0.6s ease-out"
          >
            <!-- DATA COMPARISON -->
            <div
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 2.5rem"
            >
              <!-- STEP 2: SYSTEM DATA -->
              <div
                class="card"
                style="background: #eff6ff; border: 1px solid #bfdbfe"
              >
                <h4
                  style="
                    font-size: 0.85rem;
                    color: #1e40af;
                    letter-spacing: 1px;
                    font-weight: 800;
                    text-transform: uppercase;
                  "
                >
                  2. System Records
                </h4>
                <div style="margin-top: 1.5rem">
                  <div
                    style="
                      font-weight: 800;
                      font-size: 1.4rem;
                      color: var(--text-dark);
                    "
                    th:text="${item.namaObat}"
                  >
                    Name
                  </div>
                  <div
                    style="
                      color: var(--text-muted);
                      font-size: 0.9rem;
                      margin-top: 4px;
                    "
                  >
                    Batch:
                    <span
                      style="font-family: monospace; font-weight: 600"
                      th:text="${item.nomorBatch}"
                      >B-000</span
                    >
                  </div>

                  <div
                    style="
                      margin-top: 2rem;
                      display: flex;
                      align-items: baseline;
                      gap: 10px;
                    "
                  >
                    <span
                      style="
                        font-size: 3.5rem;
                        font-weight: 900;
                        color: var(--primary);
                      "
                      th:text="${item.quantity}"
                      >0</span
                    >
                    <span style="font-weight: 700; color: var(--text-muted)"
                      >REGISTERED UNITS</span
                    >
                  </div>
                </div>
              </div>

              <!-- STEP 3: PHYSICAL INPUT -->
              <div
                class="card"
                style="background: #fdfaf1; border: 1px solid #fef3c7"
              >
                <h4
                  style="
                    font-size: 0.85rem;
                    color: #92400e;
                    letter-spacing: 1px;
                    font-weight: 800;
                    text-transform: uppercase;
                  "
                >
                  3. Physical Inventory Count
                </h4>
                <div class="form-group" style="margin-top: 1.5rem">
                  <label style="color: #92400e"
                    >Manually Counted Quantity:</label
                  >
                  <input
                    type="number"
                    name="fisik"
                    th:value="${fisik}"
                    placeholder="Enter count..."
                    required
                    style="
                      background: white;
                      border-color: #fcd34d;
                      font-size: 2rem;
                      font-weight: 800;
                      text-align: center;
                      height: 80px;
                    "
                  />
                </div>
                <button
                  type="submit"
                  class="btn"
                  style="
                    width: 100%;
                    margin-top: 1rem;
                    background: #92400e;
                    color: white;
                    height: 60px;
                    font-size: 1.1rem;
                    box-shadow: 0 4px 12px rgba(146, 64, 14, 0.3);
                  "
                >
                  <i class="fa-solid fa-calculator"></i> PERFORM AUDIT
                  COMPARISON
                </button>
              </div>
            </div>
          </div>
        </form>

        <div
          style="
            margin-top: 3rem;
            text-align: center;
            border-top: 1px solid var(--glass-border);
            padding-top: 2rem;
          "
        >
          <a
            th:href="@{/audit}"
            class="nav-link"
            style="
              display: inline-flex;
              width: auto;
              background: var(--secondary);
              color: white;
            "
          >
            <i class="fa-solid fa-rotate-left"></i> CLEAR AUDIT STATE
          </a>
        </div>
      </div>
    </div>
  </body>
</html>
