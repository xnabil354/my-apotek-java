<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">
  <body>
    <div layout:fragment="content">
      <div class="card">
        <h3
          style="
            margin-bottom: 0.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
          "
        >
          <i class="fa-solid fa-square-poll-vertical"></i> Log Sistem & Data
          Intelijen
        </h3>
        <p
          style="
            color: var(--text-muted);
            margin-bottom: 3rem;
            font-size: 1.1rem;
          "
        >
          Repositori data historis lengkap untuk pergerakan rantai pasok dan
          interaksi klinis pasien.
        </p>

        <!-- FINANCIAL SUMMARY SECTION -->
        <div
          class="card"
          style="
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
            background: #f8fafc;
          "
        >
          <h3
            style="
              margin-bottom: 2rem;
              color: var(--primary);
              font-size: 1.25rem;
            "
          >
            <i class="fa-solid fa-money-bill-trend-up"></i> Ringkasan Keuangan &
            Operasional
          </h3>

          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 1.5rem;
              margin-bottom: 2rem;
            "
          >
            <div
              style="
                background: rgba(var(--primary-rgb), 0.1);
                padding: 1.5rem;
                border-radius: 12px;
                border-left: 4px solid var(--primary);
              "
            >
              <span
                style="
                  display: block;
                  font-size: 0.8rem;
                  color: var(--text-muted);
                  text-transform: uppercase;
                  font-weight: 600;
                "
                >Total Pendapatan</span
              >
              <span
                style="
                  display: block;
                  font-size: 1.5rem;
                  font-weight: 700;
                  color: var(--primary);
                "
                th:text="'Rp ' + ${#numbers.formatDecimal(totalRevenue, 0, 'COMMA', 0, 'POINT')}"
                >Rp 0</span
              >
            </div>
            <div
              style="
                background: rgba(22, 163, 74, 0.1);
                padding: 1.5rem;
                border-radius: 12px;
                border-left: 4px solid #16a34a;
              "
            >
              <span
                style="
                  display: block;
                  font-size: 0.8rem;
                  color: var(--text-muted);
                  text-transform: uppercase;
                  font-weight: 600;
                "
                >Estimasi Margin (30%)</span
              >
              <span
                style="
                  display: block;
                  font-size: 1.5rem;
                  font-weight: 700;
                  color: #16a34a;
                "
                th:text="'Rp ' + ${#numbers.formatDecimal(totalRevenue * 0.3, 0, 'COMMA', 0, 'POINT')}"
                >Rp 0</span
              >
            </div>
            <div
              style="
                background: rgba(147, 51, 234, 0.1);
                padding: 1.5rem;
                border-radius: 12px;
                border-left: 4px solid #9333ea;
              "
            >
              <span
                style="
                  display: block;
                  font-size: 0.8rem;
                  color: var(--text-muted);
                  text-transform: uppercase;
                  font-weight: 600;
                "
                >Varian Item Aktif</span
              >
              <span
                style="
                  display: block;
                  font-size: 1.5rem;
                  font-weight: 700;
                  color: #9333ea;
                "
                th:text="${totalItems}"
                >0</span
              >
            </div>
          </div>

          <div style="display: flex; gap: 1rem; flex-wrap: wrap">
            <a
              th:href="@{/reports/export/pdf}"
              class="btn btn-primary"
              style="
                padding: 12px 24px;
                border-radius: 10px;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 8px;
              "
            >
              <i class="fa-solid fa-file-pdf"></i> Cetak Laporan Keuangan (PDF)
            </a>
            <button
              class="btn"
              style="
                background: var(--secondary);
                color: white;
                padding: 12px 24px;
                border-radius: 10px;
                border: none;
                cursor: pointer;
                display: inline-flex;
                align-items: center;
                gap: 8px;
              "
              onclick="window.print()"
            >
              <i class="fa-solid fa-print"></i> Print Halaman
            </button>
          </div>
        </div>

        <!-- SECTION 1: LOG INVENTORI -->
        <div
          class="card"
          style="
            background: rgba(255, 255, 255, 0.4);
            box-shadow: none;
            border-color: #e2e8f0;
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 1.5rem;
              flex-wrap: wrap;
              gap: 10px;
            "
          >
            <h4
              style="
                margin-bottom: 0;
                color: #1e3a8a;
                display: flex;
                align-items: center;
                gap: 10px;
              "
            >
              <i class="fa-solid fa-truck-moving"></i> Pergerakan Rantai Pasok
              (Masuk/Keluar)
            </h4>
            <span
              style="
                font-size: 0.8rem;
                background: #dbeafe;
                color: #1e40af;
                padding: 4px 12px;
                border-radius: 20px;
                font-weight: 700;
              "
              >LOG REAL-TIME</span
            >
          </div>

          <div class="table-container">
            <table>
              <thead style="background: #f8fafc">
                <tr>
                  <th>Waktu</th>
                  <th>Nama Obat</th>
                  <th>ID Batch</th>
                  <th>Tipe Pergerakan</th>
                  <th>Jumlah Perubahan</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="r : ${riwayatBarang}">
                  <td
                    style="font-family: monospace; font-size: 0.85rem"
                    th:text="${#temporals.format(r.timestamp, 'yyyy-MM-dd HH:mm')}"
                  ></td>
                  <td style="font-weight: 600" th:text="${r.namaObat}"></td>
                  <td
                    style="font-family: monospace; color: var(--text-muted)"
                    th:text="${r.nomorBatch}"
                  ></td>
                  <td>
                    <span
                      th:if="${r.tipe == 'MASUK'}"
                      style="
                        background: #dcfce7;
                        color: #166534;
                        padding: 4px 10px;
                        border-radius: 20px;
                        font-size: 0.75rem;
                        font-weight: 700;
                      "
                    >
                      <i class="fa-solid fa-arrow-down-long"></i> STOK MASUK
                    </span>
                    <span
                      th:if="${r.tipe == 'KELUAR'}"
                      style="
                        background: #fee2e2;
                        color: #991b1b;
                        padding: 4px 10px;
                        border-radius: 20px;
                        font-size: 0.75rem;
                        font-weight: 700;
                      "
                    >
                      <i class="fa-solid fa-arrow-up-long"></i> STOK KELUAR
                    </span>
                  </td>
                  <td
                    style="font-weight: 800; font-size: 1.1rem"
                    th:text="${r.quantity}"
                  ></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div
            th:if="${riwayatBarang.empty}"
            style="text-align: center; padding: 2rem; color: var(--text-muted)"
          >
            Belum ada pergerakan stok.
          </div>
        </div>

        <!-- SECTION 2: LOG KLINIS -->
        <div
          class="card"
          style="
            background: rgba(255, 255, 255, 0.4);
            box-shadow: none;
            border-color: #e2e8f0;
            margin-top: 3rem;
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 1.5rem;
              flex-wrap: wrap;
              gap: 10px;
            "
          >
            <h4
              style="
                margin-bottom: 0;
                color: #0f766e;
                display: flex;
                align-items: center;
                gap: 10px;
              "
            >
              <i class="fa-solid fa-stethoscope"></i> Riwayat Pelayanan &
              Penyerahan Obat
            </h4>
            <span
              style="
                font-size: 0.8rem;
                background: #ccfbf1;
                color: #0f766e;
                padding: 4px 12px;
                border-radius: 20px;
                font-weight: 700;
              "
              >REKAM MEDIS</span
            >
          </div>

          <div class="table-container">
            <table>
              <thead style="background: #f0fdfa">
                <tr>
                  <th>Tgl Kunjungan</th>
                  <th>ID Pasien (NIK)</th>
                  <th>Nama Pasien</th>
                  <th>Diagnosis</th>
                  <th>Terapi Diberikan</th>
                  <th>Dosis / Aturan</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="k : ${riwayatKlinis}">
                  <td th:text="${k.tglKunjungan}"></td>
                  <td style="font-family: monospace" th:text="${k.nik}"></td>
                  <td style="font-weight: 600" th:text="${k.namaPasien}"></td>
                  <td th:text="${k.diagnosa}"></td>
                  <td
                    style="
                      color: var(--primary);
                      font-weight: 700;
                      background: #eff6ff;
                      padding: 10px;
                    "
                    th:text="${k.namaObat}"
                  ></td>
                  <td style="font-style: italic" th:text="${k.dosis}"></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div
            th:if="${riwayatKlinis.empty}"
            style="text-align: center; padding: 2rem; color: var(--text-muted)"
          >
            Belum ada riwayat pelayanan.
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
